(()=>{"use strict";class t{constructor(){this.boardSize=10,this.coordinates=new Map,this.AttackStorage=[],this.coordinates2=new Map,this.playerboard=this.createBoard()}createBoard(){const t=[];for(let e=0;e<this.boardSize;e++){const e=[];for(let t=0;t<this.boardSize;t++)e.push(0);t.push(e)}return t}placeShip(t,e){const o=document.querySelector(".container").querySelector(`.${e}`);for(const e of t){let r=0;const n=t.indexOf(e);let a=[];for(let t=0;t<e.length;t++)o.querySelector(`[data-coordinate='${JSON.stringify([r+t,n])}']`).style.backgroundColor="white",a.push([r+t,n]);r++,this.AddShipCoords(e,a)}}placeRandomShips(t,e){const o=document.querySelector(".container").querySelector(`.${e}`);for(const r of t){let t,n,a,i,c,s=[];do{t=Math.floor(10*Math.random()),n=Math.floor(10*Math.random()),i=[t,n],a=Math.round(Math.random()),c=this.checkShipCoords(r.length,i,a)}while(t+r.length>9||n+r.length>9||!1===c);if(1===a)for(let a=0;a<r.length;a++)s.push([t+a,n]),"one"===e&&(o.querySelector(`[data-coordinate='${JSON.stringify([t+a,n])}']`).style.backgroundColor="white");else for(let a=0;a<r.length;a++)s.push([t,n+a]),"one"===e&&(o.querySelector(`[data-coordinate='${JSON.stringify([t,n+a])}']`).style.backgroundColor="white");this.AddShipCoords(r,s)}}checkShipCoords(t,e,o){for(const r of this.coordinates.values())for(const n of r){let r=e[0],a=e[1];for(let e=0;e<t;e++)if(1===o){if(n[0]===r&&n[1]===a)return!1;r++}else{if(n[0]===r&&n[1]===a)return!1;a++}}return!0}AddShipCoords(t,e){this.coordinates.set(t,e),this.coordinates2.set(t,[...e])}receiveAttack(t,e){for(let e=0;e<this.AttackStorage.length;e++)if(JSON.stringify(t)==JSON.stringify(this.AttackStorage[e]))return!1;const o=document.querySelector(".container").querySelector(`.${e}`);let r=!1;this.coordinates.forEach(((e,n)=>{e.forEach(((a,i)=>{if(a[0]===t[0]&&a[1]===t[1]&&(n.hit(),e.splice(i,1),this.checkSunk(),r=!0,o.querySelectorAll(".cell").forEach((e=>{const o=JSON.parse(e.getAttribute("data-coordinate"));o[0]===t[0]&&o[1]===t[1]&&(e.style.backgroundColor="red")}))),1==n.sunk){const t=this.coordinates2.get(n),e=o.querySelectorAll(".cell");t.forEach((t=>{e.forEach((e=>{const o=JSON.parse(e.getAttribute("data-coordinate"));o[0]===t[0]&&o[1]===t[1]&&(e.style.backgroundColor="black")}))}))}}))})),r||o.querySelectorAll(".cell").forEach((e=>{const o=JSON.parse(e.getAttribute("data-coordinate"));o[0]===t[0]&&o[1]===t[1]&&(e.style.backgroundColor="blue")})),this.AttackStorage.push(t)}checkSunk(){let t=!0;return this.coordinates.forEach((e=>{e.length>0&&(t=!1)})),t}}class e{constructor(t,e=0,o=!1){this.length=t,this.numOfHits=e,this.sunk=o}hit(){this.numOfHits!==this.length&&this.numOfHits++,this.numOfHits===this.length&&this.isSunk()}isSunk(){this.sunk=!0}}class o{constructor(o){this.word=o,this.gameBoard=new t(o),this.PlayerShips=[new e(5),new e(4),new e(3),new e(3),new e(2)]}attack(t){this.gameBoard.receiveAttack(t,this.word)}makeRandomAttack(t){const e=this.gameBoard.boardSize;let o,r=!0;for(;r;){o=[Math.floor(Math.random()*e),Math.floor(Math.random()*e)],r=!1;for(let t=0;t<this.gameBoard.AttackStorage.length;t++)if(JSON.stringify(o)===JSON.stringify(this.gameBoard.AttackStorage[t])){r=!0;break}}this.gameBoard.receiveAttack(o,t)}gameOver(){return this.gameBoard.checkSunk()}}const r=new o("one"),n=new o("two");function a(t){let e=document.querySelector(".container"),o=document.createElement("div");o.classList.add("grid",t),e.append(o);for(let t=0;t<10;t++){const e=[];for(let r=0;r<10;r++){const n=document.createElement("div");n.classList.add("cell"),n.setAttribute("data-coordinate",`[${t},${r}]`),o.appendChild(n),e.push(0)}}}a("one"),a("two"),r.gameBoard.placeRandomShips(r.PlayerShips,"one"),n.gameBoard.placeRandomShips(n.PlayerShips);const i=document.querySelector(".btn"),c=document.querySelector(".two").querySelectorAll(".cell"),s=document.querySelector(".playerNum");function l(t){const e=t.target,o=e.getAttribute("data-coordinate");n.attack(JSON.parse(o),"two"),r.makeRandomAttack("one"),e.removeEventListener("click",l),function(){const t=n.gameOver();r.gameOver()?(s.textContent="Player 2 wins",c.forEach((t=>{t.removeEventListener("click",l)})),i.style.visibility="visible",i.addEventListener("click",(function(){window.location.reload()}))):t&&(s.textContent="Player 1 wins",c.forEach((t=>{t.removeEventListener("click",l)})),i.style.visibility="visible",i.addEventListener("click",(function(){window.location.reload()})))}()}c.forEach((t=>{t.addEventListener("click",l)}));let d=null;const h=document.querySelectorAll(".ship"),u=(document.querySelectorAll(".cell"),document.querySelector(".one"));function f(t){d=t.target}function S(t){d=null}h.forEach((t=>{t.addEventListener("dragstart",f),t.addEventListener("dragend",S)})),u.addEventListener("drop",(function(t){t.preventDefault();const e=t.target;e.classList.contains("cell")&&e.appendChild(d)})),u.addEventListener("dragover",(function(t){t.preventDefault()}))})();